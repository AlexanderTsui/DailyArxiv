from __future__ import annotations

from typing import Any


TRANSLATIONS: dict[str, dict[str, str]] = {
    "zh": {
        "app_title": "DailyArxiv GUI",
        "page": "页面",
        "run": "生成日报",
        "history": "历史记录",
        "settings": "设置",
        "about": "关于",
        "language": "语言",
        "config_path": "配置文件路径",
        "config": "配置",
        "save_config": "保存配置",
        "save_path": "保存到文件",
        "autosave_on_run": "点击生成时自动保存",
        "save_api_key": "保存 API key（不安全）",
        "btn_save": "保存",
        "saved_ok": "已保存到：{path}",
        "saved_fail": "保存失败：{error}",
        "llm": "LLM",
        "llm_caption": "API key 默认只从环境变量读取（优先 GEMINI_API_KEY，其次 OPENAI_API_KEY）。不会写入文件。",
        "api_key_session": "API key（仅本次会话）",
        "base_url": "Base URL",
        "model_fast": "模型（fast）",
        "model_smart": "模型（smart）",
        "temperature": "Temperature",
        "search": "抓取",
        "categories": "分区（Categories）",
        "mode": "模式（Mode）",
        "timezone": "时区（Timezone）",
        "lookback_days": "回溯天数（lookback_days）",
        "time_window_hours": "时间窗口小时数（time_window_hours）",
        "max_results": "最大候选数（max_results）",
        "filter": "筛选",
        "kw_include": "keywords_include（每行一个）",
        "kw_exclude": "keywords_exclude（每行一个）",
        "relevance_threshold": "相关性阈值（relevance_threshold）",
        "max_selected": "每日最多入选（max_selected）",
        "trend": "趋势",
        "enable_weekly": "开启本周趋势",
        "enable_monthly": "开启本月趋势",
        "weekly_days": "周窗口天数（weekly_days）",
        "monthly_days": "月窗口天数（monthly_days）",
        "top_k_keywords": "关键词 Top-K（top_k_keywords）",
        "chart_type": "关键词图（chart_type）",
        "output": "输出",
        "out_dir": "输出目录（out-dir）",
        "html_template": "HTML 模板（html_template）",
        "write_pdf": "生成 PDF（write_pdf）",
        "live": "实时刷新",
        "auto_refresh_ms": "自动刷新（毫秒）",
        "run_header": "运行",
        "date": "date",
        "dry_run": "dry-run",
        "html_only": "html-only",
        "pdf_only": "pdf-only",
        "override_max_results": "覆盖 max_results（可选）",
        "override_max_selected": "覆盖 max_selected（可选）",
        "btn_run": "开始生成",
        "btn_cancel": "取消",
        "cancel_requested": "已请求取消。",
        "result": "结果",
        "download_html": "下载 HTML",
        "download_pdf": "下载 PDF",
        "download_json": "下载 JSON",
        "download_debug": "下载 Debug",
        "download_exported_json": "下载 exported_report.json",
        "html_preview": "HTML 预览",
        "no_progress": "暂无进度。",
        "output_dir": "输出目录",
        "live_html_preview": "实时 HTML 预览（文件更新时刷新）",
        "history_title": "历史记录（SQLite）",
        "sqlite_path": "SQLite 路径",
        "no_sqlite": "尚未找到 SQLite 归档。",
        "export_by_date": "按日期导出",
        "date_input": "date（YYYY-MM-DD）",
        "btn_export_json": "导出 JSON",
        "need_date": "请先输入日期。",
        "browse_reports": "浏览 reports 目录",
        "reports_root": "reports 根目录",
        "report_date": "report_date",
        "no_reports_dir": "未找到 reports 目录。",
        "diagnostics": "诊断",
        "env_gemini": "环境变量 GEMINI_API_KEY",
        "env_openai": "环境变量 OPENAI_API_KEY",
        "set": "已设置",
        "missing": "未设置",
        "weasyprint": "WeasyPrint 可用",
        "weasyprint_hint": "如 Windows 下不可用，建议：`conda install -c conda-forge weasyprint -y`",
        "stage": "阶段",
        "auto_or_date_help": "auto 或 YYYY-MM-DD",
        "select": "（请选择）",
        "about_md": (
            "**DailyArxiv GUI**\n\n"
            "- 核心：`dailyarxiv run` 流水线\n"
            "- 产物：HTML + PDF + JSON + Debug JSON\n"
            "- Spotlight：后续版本接入外部信号源后启用"
        ),
    },
    "en": {
        "app_title": "DailyArxiv GUI",
        "page": "Page",
        "run": "Run",
        "history": "History",
        "settings": "Settings",
        "about": "About",
        "language": "Language",
        "config_path": "Config path",
        "config": "Config",
        "save_config": "Save config",
        "save_path": "Save to file",
        "autosave_on_run": "Autosave on Run",
        "save_api_key": "Save API key (unsafe)",
        "btn_save": "Save",
        "saved_ok": "Saved to: {path}",
        "saved_fail": "Save failed: {error}",
        "llm": "LLM",
        "llm_caption": "API key is read from env vars only (GEMINI_API_KEY preferred, then OPENAI_API_KEY). Never written to disk.",
        "api_key_session": "API key (session only)",
        "base_url": "Base URL",
        "model_fast": "Model (fast)",
        "model_smart": "Model (smart)",
        "temperature": "Temperature",
        "search": "Search",
        "categories": "Categories",
        "mode": "Mode",
        "timezone": "Timezone",
        "lookback_days": "lookback_days",
        "time_window_hours": "time_window_hours",
        "max_results": "max_results",
        "filter": "Filter",
        "kw_include": "keywords_include (one per line)",
        "kw_exclude": "keywords_exclude (one per line)",
        "relevance_threshold": "relevance_threshold",
        "max_selected": "max_selected",
        "trend": "Trend",
        "enable_weekly": "enable_weekly",
        "enable_monthly": "enable_monthly",
        "weekly_days": "weekly_days",
        "monthly_days": "monthly_days",
        "top_k_keywords": "top_k_keywords",
        "chart_type": "chart_type",
        "output": "Output",
        "out_dir": "out-dir",
        "html_template": "html_template",
        "write_pdf": "write_pdf",
        "live": "Live",
        "auto_refresh_ms": "auto refresh (ms)",
        "run_header": "Run",
        "date": "date",
        "dry_run": "dry-run",
        "html_only": "html-only",
        "pdf_only": "pdf-only",
        "override_max_results": "override max_results (optional)",
        "override_max_selected": "override max_selected (optional)",
        "btn_run": "Run",
        "btn_cancel": "Cancel",
        "cancel_requested": "Cancel requested.",
        "result": "Result",
        "download_html": "Download HTML",
        "download_pdf": "Download PDF",
        "download_json": "Download JSON",
        "download_debug": "Download Debug",
        "download_exported_json": "Download exported_report.json",
        "html_preview": "HTML Preview",
        "no_progress": "No progress yet.",
        "output_dir": "Output dir",
        "live_html_preview": "Live HTML preview (updates as file changes)",
        "history_title": "History (SQLite)",
        "sqlite_path": "SQLite path",
        "no_sqlite": "No SQLite archive found yet.",
        "export_by_date": "Export by date",
        "date_input": "date (YYYY-MM-DD)",
        "btn_export_json": "Export JSON",
        "need_date": "Please input date.",
        "browse_reports": "Browse reports directory",
        "reports_root": "reports root",
        "report_date": "report_date",
        "no_reports_dir": "No reports directory found.",
        "diagnostics": "Diagnostics",
        "env_gemini": "Env GEMINI_API_KEY",
        "env_openai": "Env OPENAI_API_KEY",
        "set": "set",
        "missing": "missing",
        "weasyprint": "WeasyPrint available",
        "weasyprint_hint": "If missing on Windows: `conda install -c conda-forge weasyprint -y`",
        "stage": "Stage",
        "auto_or_date_help": "auto or YYYY-MM-DD",
        "select": "(select)",
        "about_md": (
            "**DailyArxiv GUI**\n\n"
            "- Core: `dailyarxiv run` pipeline\n"
            "- Outputs: HTML + PDF + JSON + Debug JSON\n"
            "- Spotlight: enabled in future versions with external signals"
        ),
    },
}


def tr(lang: str, key: str, **kwargs: Any) -> str:
    table = TRANSLATIONS.get(lang) or TRANSLATIONS["zh"]
    text = table.get(key) or TRANSLATIONS["zh"].get(key) or key
    if kwargs:
        try:
            return text.format(**kwargs)
        except Exception:
            return text
    return text
