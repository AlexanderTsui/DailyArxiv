<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ArXiv Daily Express · {{ report.date }}</title>
    <style>
      :root {
        --bg: #ffffff;
        --ink: #111827;
        --muted: #6b7280;
        --border: #e5e7eb;
        --shadow: 0 10px 24px rgba(17, 24, 39, 0.08);

        --motivation: #fadbd8;
        --method: #d5f5e3;
        --chip: #f3f4f6;
        --chip-ink: #374151;

        --spot: #fff7ed;
        --spot-border: #fdba74;
      }

      @page {
        size: A4;
        margin: 16mm 14mm 16mm 14mm;
        @bottom-center {
          content: "ArXiv Daily Express  ·  " counter(page) " / " counter(pages);
          color: #9ca3af;
          font-size: 10px;
          font-family: Arial, "Helvetica Neue", Helvetica, "Microsoft YaHei", sans-serif;
        }
      }

      * { box-sizing: border-box; }

      body {
        margin: 0;
        background: #f5f6f8;
        color: var(--ink);
        font-family: Georgia, "Times New Roman", Times, "SimSun", "Songti SC", serif;
        line-height: 1.45;
      }

      a { color: inherit; text-decoration: none; border-bottom: 1px dotted #cbd5e1; }

      .preview-shell {
        max-width: 1000px;
        margin: 28px auto;
        padding: 0 16px 48px;
      }

      .page {
        background: var(--bg);
        border: 1px solid var(--border);
        border-radius: 10px;
        box-shadow: var(--shadow);
        overflow: hidden;
        margin: 0 auto 22px;
        padding: 18mm 16mm;
        width: min(210mm, 100%);
      }

      .page-break { break-after: page; page-break-after: always; }

      .brand {
        display: flex;
        align-items: baseline;
        justify-content: space-between;
        gap: 12px;
        padding-bottom: 10px;
        border-bottom: 1px solid var(--border);
        margin-bottom: 14px;
      }

      .brand h1 {
        margin: 0;
        font-family: Arial, "Helvetica Neue", Helvetica, "Microsoft YaHei", sans-serif;
        font-size: 22px;
        letter-spacing: -0.2px;
      }

      .brand .meta {
        text-align: right;
        font-family: Arial, "Helvetica Neue", Helvetica, "Microsoft YaHei", sans-serif;
        font-size: 12px;
        color: var(--muted);
        line-height: 1.35;
      }

      .chips {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
        margin: 10px 0 0;
        padding: 0;
        list-style: none;
      }

      .chip {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 4px 9px;
        border: 1px solid var(--border);
        border-radius: 999px;
        background: var(--chip);
        color: var(--chip-ink);
        font-family: Arial, "Helvetica Neue", Helvetica, "Microsoft YaHei", sans-serif;
        font-size: 11px;
        white-space: nowrap;
      }

      .chip strong { font-weight: 700; }

      .section-title {
        margin: 18px 0 10px;
        font-family: Arial, "Helvetica Neue", Helvetica, "Microsoft YaHei", sans-serif;
        font-size: 15px;
        letter-spacing: -0.1px;
      }

      .lede {
        display: grid;
        grid-template-columns: 1.2fr 0.8fr;
        gap: 14px;
        margin-top: 12px;
      }

      .trend, .top3 {
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 12px 12px 10px;
      }

      .trend .label, .top3 .label {
        font-family: Arial, "Helvetica Neue", Helvetica, "Microsoft YaHei", sans-serif;
        color: var(--muted);
        font-size: 11px;
        margin-bottom: 6px;
      }

      .trend p { margin: 0; font-size: 14px; }
      .top3 ol { margin: 0; padding-left: 18px; }
      .top3 li { margin: 0 0 8px; font-size: 13px; }
      .top3 .t { font-family: Arial, "Helvetica Neue", Helvetica, "Microsoft YaHei", sans-serif; font-weight: 700; }
      .top3 .sub { font-family: Arial, "Helvetica Neue", Helvetica, "Microsoft YaHei", sans-serif; color: var(--muted); font-size: 11px; }

      .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }

      .card {
        border: 1px solid var(--border);
        border-radius: 14px;
        padding: 12px;
        break-inside: avoid;
        page-break-inside: avoid;
      }

      .card h3 {
        margin: 0 0 6px;
        font-family: Arial, "Helvetica Neue", Helvetica, "Microsoft YaHei", sans-serif;
        font-size: 14px;
        letter-spacing: -0.1px;
      }

      .card .sub {
        margin: 0 0 10px;
        font-family: Arial, "Helvetica Neue", Helvetica, "Microsoft YaHei", sans-serif;
        color: var(--muted);
        font-size: 11px;
      }

      .row { display: flex; flex-wrap: wrap; gap: 6px; margin: 0 0 10px; }

      .box { border-radius: 12px; padding: 10px 10px 9px; margin: 0 0 10px; }
      .box .k {
        font-family: Arial, "Helvetica Neue", Helvetica, "Microsoft YaHei", sans-serif;
        font-size: 11px;
        color: #111827;
        font-weight: 800;
        margin: 0 0 6px;
      }
      .box p { margin: 0; font-size: 13px; }
      .motivation { background: var(--motivation); }
      .method { background: var(--method); }

      .pill {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 5px 10px;
        border: 1px solid var(--border);
        border-radius: 999px;
        background: #fff;
        font-family: Arial, "Helvetica Neue", Helvetica, "Microsoft YaHei", sans-serif;
        font-size: 11px;
      }
      .pill .dot { width: 6px; height: 6px; border-radius: 999px; background: #9ca3af; }
      .pill.tag { background: var(--chip); }
      .pill.good .dot { background: #10b981; }
      .pill.warn .dot { background: #f59e0b; }
      .pill.hot .dot { background: #ef4444; }

      .why { border-top: 1px dashed var(--border); padding-top: 10px; margin-top: 8px; }
      .why .k { font-family: Arial, "Helvetica Neue", Helvetica, "Microsoft YaHei", sans-serif; font-size: 11px; color: var(--muted); margin: 0 0 6px; font-weight: 700; }
      .why p { margin: 0; font-size: 12.5px; }

      .spotlight { border: 1px solid var(--spot-border); background: var(--spot); }
      .spotlight-header { display: flex; align-items: baseline; justify-content: space-between; gap: 10px; margin-bottom: 8px; }
      .spotlight-header .badge {
        display: inline-flex; align-items: center; gap: 6px;
        padding: 4px 10px; border-radius: 999px;
        border: 1px solid rgba(251, 146, 60, 0.6);
        background: rgba(251, 146, 60, 0.12);
        font-family: Arial, "Helvetica Neue", Helvetica, "Microsoft YaHei", sans-serif;
        font-size: 11px; font-weight: 800;
      }

      .signals { width: 100%; border-collapse: collapse; margin-top: 8px; font-family: Arial, "Helvetica Neue", Helvetica, "Microsoft YaHei", sans-serif; font-size: 11px; color: #374151; }
      .signals th, .signals td { border-top: 1px solid rgba(251, 146, 60, 0.35); padding: 6px 6px; text-align: left; vertical-align: top; }
      .signals th { color: #7c2d12; font-weight: 800; }

      .trend-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
      .trend-box {
        border: 1px solid var(--border);
        border-radius: 14px;
        padding: 12px;
        break-inside: avoid;
        page-break-inside: avoid;
      }
      .trend-box .range {
        font-family: Arial, "Helvetica Neue", Helvetica, "Microsoft YaHei", sans-serif;
        font-size: 11px;
        color: var(--muted);
        margin: 0 0 8px;
      }

      .bars { margin: 10px 0 0; display: grid; gap: 6px; }
      .bar {
        display: grid;
        grid-template-columns: 1fr 80px;
        gap: 10px;
        align-items: center;
        font-family: Arial, "Helvetica Neue", Helvetica, "Microsoft YaHei", sans-serif;
        font-size: 11px;
        color: #374151;
      }
      .bar .track { height: 10px; border-radius: 999px; background: #eef2f7; border: 1px solid #e5e7eb; overflow: hidden; }
      .bar .fill { height: 100%; background: linear-gradient(90deg, #60a5fa, #a78bfa); border-radius: 999px; }
      .bar .w { text-align: right; color: var(--muted); }

      @media (max-width: 860px) {
        .lede, .grid, .trend-grid { grid-template-columns: 1fr; }
      }
      @media print {
        body { background: #fff; }
        .preview-shell { max-width: none; margin: 0; padding: 0; }
        .page { box-shadow: none; border: none; border-radius: 0; width: auto; margin: 0; padding: 0; }
      }
    </style>
  </head>
  <body>
    <div class="preview-shell">
      <!-- Page 1 -->
      <section class="page page-break">
        <div class="brand">
          <div>
            <h1>ArXiv Daily Express · 学术速递</h1>
            <ul class="chips">
              <li class="chip"><strong>报告日</strong> {{ report.date }}</li>
              <li class="chip"><strong>分区</strong> {{ report.categories | join(" · ") }}</li>
              <li class="chip"><strong>关键词</strong> {{ report.keywords | join(" / ") }}</li>
            </ul>
          </div>
          <div class="meta">
            生成时间：{{ report.generated_at }}<br />
            抓取窗口：{{ report.source_range_start }} ~ {{ report.source_range_end }}<br />
            入选：{{ report.papers | length }} 篇 · Spotlight：{{ report.spotlight | length }} 篇
          </div>
        </div>

        <div class="lede">
          <div class="trend">
            <div class="label">今日趋势 · Global Trend</div>
            <p>{{ report.global_trend }}</p>
          </div>
          <div class="top3">
            <div class="label">Top 3 推荐</div>
            {% set top = (report.papers | sort(attribute="score", reverse=true))[:3] %}
            <ol>
              {% for p in top %}
              <li>
                <span class="t">{{ p.title_en }}</span><br />
                <span class="sub">{{ p.primary_category }} · 推荐度 {{ p.score }}/5 · 相关度 {{ p.relevance.relevance_score }}</span>
              </li>
              {% endfor %}
            </ol>
          </div>
        </div>

        <h2 class="section-title">阅读方式建议</h2>
        <ul style="margin: 0; padding-left: 18px; font-size: 13px">
          <li>先看 Top 3 + 今日趋势，快速掌握“今天发生了什么”。</li>
          <li>每篇先扫 Motivation/Method，再决定是否点开全文。</li>
          <li>若启用 Spotlight，会展示可追溯外部信号来源与指标。</li>
        </ul>
      </section>

      <!-- Page 2+: Papers -->
      <section class="page page-break">
        <h2 class="section-title" style="margin-top: 0">精选论文 · Selected Papers</h2>
        <div class="grid">
          {% for p in report.papers %}
          <article class="card">
            <h3><a href="{{ p.url }}">{{ p.title_en }}</a></h3>
            <p class="sub">
              arXiv:{{ p.id }} · {{ p.publish_date }} · {{ p.authors | join(", ") }}
              <br/>
              {% set affs = p.affiliations | default([]) %}
              单位：{% if affs %}{{ affs | join("；") }}{% else %}—{% endif %}
            </p>
            <div class="row">
              <span class="pill tag"><span class="dot"></span>{{ p.primary_category }}</span>
              <span class="pill good"><span class="dot"></span>相关度 {{ p.relevance.relevance_score }}</span>
              <span class="pill warn"><span class="dot"></span>推荐度 {{ p.score }}/5</span>
              <span class="pill tag"><span class="dot"></span>{{ p.paradigm_relation }}</span>
            </div>
            <div class="box motivation">
              <div class="k">Motivation · 痛点</div>
              <p>{{ p.motivation }}</p>
            </div>
            <div class="box method">
              <div class="k">Method · 方法</div>
              <p>{{ p.method }}</p>
            </div>
            <div class="box" style="background: rgba(148,163,184,.10); border: 1px solid var(--border)">
              <div class="k">Abstract · 摘要翻译</div>
              {% set s = (p.summary_cn | default("") | trim) %}
              <p>{{ s if s else "（无）" }}</p>
            </div>
            <div class="why">
              <div class="k">为什么入选</div>
              <p>命中：{{ p.relevance.matched_terms | join(" / ") }}。理由：{{ p.relevance.reason_cn }}</p>
            </div>
          </article>
          {% endfor %}
        </div>
      </section>

      {% if report.spotlight and report.spotlight | length > 0 %}
      <section class="page page-break">
        <h2 class="section-title" style="margin-top: 0">Spotlight · 发表不久但被广泛关注</h2>
        {% for s in report.spotlight %}
        <article class="card spotlight">
          <div class="spotlight-header">
            <h3 style="margin: 0">{{ s.paper_id }}</h3>
            <span class="badge">Attention Score · {{ s.attention_score }}/100</span>
          </div>
          <div class="box" style="background: rgba(255,255,255,.55); border: 1px solid rgba(251,146,60,.35)">
            <div class="k">特别介绍</div>
            <p>{{ s.intro_cn }}</p>
          </div>
          <table class="signals">
            <thead>
              <tr>
                <th style="width: 22%">来源</th>
                <th style="width: 28%">指标</th>
                <th style="width: 18%">数值</th>
                <th>抓取时间</th>
              </tr>
            </thead>
            <tbody>
              {% for sig in s.signals %}
              <tr>
                <td>{{ sig.source }}</td>
                <td>{{ sig.metric }}</td>
                <td>{{ sig.value }}</td>
                <td>{{ sig.fetched_at }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </article>
        {% endfor %}
      </section>
      {% endif %}

      <!-- Final: Weekly/Monthly Trends -->
      <section class="page">
        <h2 class="section-title" style="margin-top: 0">本周 / 本月趋势 · Weekly & Monthly Trends</h2>
        <div class="trend-grid">
          {% if report.weekly_trend %}
          <section class="trend-box">
            <h3 style="margin: 0 0 6px; font-family: Arial, sans-serif; font-size: 14px">本周趋势</h3>
            <p class="range">范围：{{ report.weekly_trend.start_date }} ~ {{ report.weekly_trend.end_date }}</p>
            <p style="margin: 0; font-size: 13.5px">{{ report.weekly_trend.summary_cn }}</p>
            <div class="bars" aria-label="Weekly keywords">
              {% for kw in report.weekly_trend.keywords %}
              <div class="bar">
                <div class="track"><div class="fill" style="width: {{ (kw.weight * 100) | round(0) }}%"></div></div>
                <div class="w">{{ kw.keyword }}</div>
              </div>
              {% endfor %}
            </div>
          </section>
          {% else %}
          <section class="trend-box">
            <h3 style="margin: 0 0 6px; font-family: Arial, sans-serif; font-size: 14px">本周趋势</h3>
            <p class="range">（未启用）</p>
          </section>
          {% endif %}

          {% if report.monthly_trend %}
          <section class="trend-box">
            <h3 style="margin: 0 0 6px; font-family: Arial, sans-serif; font-size: 14px">本月趋势</h3>
            <p class="range">范围：{{ report.monthly_trend.start_date }} ~ {{ report.monthly_trend.end_date }}</p>
            <p style="margin: 0; font-size: 13.5px">{{ report.monthly_trend.summary_cn }}</p>
            <div class="bars" aria-label="Monthly keywords">
              {% for kw in report.monthly_trend.keywords %}
              <div class="bar">
                <div class="track"><div class="fill" style="width: {{ (kw.weight * 100) | round(0) }}%"></div></div>
                <div class="w">{{ kw.keyword }}</div>
              </div>
              {% endfor %}
            </div>
          </section>
          {% else %}
          <section class="trend-box">
            <h3 style="margin: 0 0 6px; font-family: Arial, sans-serif; font-size: 14px">本月趋势</h3>
            <p class="range">（未启用）</p>
          </section>
          {% endif %}
        </div>
      </section>
    </div>
  </body>
</html>
